/// <reference path="../../definitions/underscore.d.ts" />
/// <reference path="../../definitions/zepto.d.ts" />
/// <reference path="factory/flip-factory.ts" />
/// <reference path="enum/start-enum.ts" />
/// <reference path="enum/fliptype-enum.ts" />

module Q {
    
    export class Flipper {

        private flipFactory: any;
        private startEnum: StartEnum = StartEnum.Failure;
        private flipTypeEnum: FlipTypeEnum = FlipTypeEnum.Simple;

        start(id: string, option: any) {
            this.flipFactory = this.createFlipFactory($('#' + id), this.checkFlipType(option.type));
            this.startEnum = StartEnum.Success;
            this.refresh();
        }

        private createFlipFactory($el: ZeptoCollection, flipType: FlipTypeEnum): FlipFactory {
            return new FlipFactory($el, flipType);
        }

        refresh() {
            if(this.checkStart()) {
                this.flipFactory.refresh();
            }
        }

        toNext() {
            if(this.checkStart()) {
                this.flipFactory.toNext();
            }
        }

        toPrev() {
            if(this.checkStart()) {
                this.flipFactory.toPrev();
            }
        }

        moveToPoint(point: number) {
            if(this.checkStart()) {
                this.flipFactory.moveToPoint(point);
            }
        }

        private checkStart(): boolean {
            if(this.startEnum === StartEnum.Success) {
                return true;
            }
            if(this.startEnum === StartEnum.Failure) {
                return false;
            }
        }

        private checkFlipType(type: string): FlipTypeEnum {
            if(type === 'simple') {
                return FlipTypeEnum.Simple;
            }
            if(type === 'rich') {
                return FlipTypeEnum.Rich;
            }
        }

    }

}
